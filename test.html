<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Native Faucet Admin</title>
<script src="https://cdn.jsdelivr.net/npm/ethers@6.6.0/dist/ethers.umd.min.js"></script>

<style>
    body {
        background: #0b0b0b;
        color: #e0e0e0;
        font-family: Consolas, monospace;
        padding: 20px;
    }
    .panel {
        background: #111;
        border: 1px solid #333;
        padding: 15px;
        margin-bottom: 20px;
    }
    input {
        width: 260px;
        background: #111;
        border: 1px solid #333;
        color: #eee;
        padding: 6px;
        margin: 5px 0;
    }
    button {
        background: #111;
        border: 1px solid #444;
        padding: 8px 12px;
        color: #eee;
        cursor: pointer;
        margin-top: 5px;
    }
    button:hover { background: #222; }
    pre {
        background: #111;
        border: 1px solid #333;
        padding: 10px;
    }
    #logs {
        background: #111;
        border: 1px solid #333;
        padding: 15px;
        height: 250px;
        overflow-y: scroll;
    }
</style>

</head>
<body>

<h1>âš¡ Native Faucet Admin</h1>

<!-- ---------------- CONNECT WALLET ---------------- -->
<div class="panel">
    <h2>Wallet</h2>
    <button id="connectWallet">Connect Wallet</button>
    <p><strong>Address:</strong> <span id="walletAddress">Not connected</span></p>
    <p><strong>Network:</strong> <span id="networkName">Unknown</span></p>
</div>

<!-- ---------------- DEPLOY CONTRACT ---------------- -->
<div class="panel">
    <h2>Deploy Faucet Contract</h2>
    <label>Constructor Args (comma separated)</label><br>
    <input id="constructorArgs" placeholder="e.g. 10000000000000000, 300"><br>
    <button id="deployContract">Deploy</button>
</div>

<!-- ---------------- LOAD EXISTING FAUCET ---------------- -->
<div class="panel">
    <h2>Load Faucet Contract</h2>
    <input id="faucetAddressInput" placeholder="Contract address">
    <button id="loadContract">Load</button>
</div>

<!-- ---------------- CONTRACT INFO ---------------- -->
<div class="panel">
    <h2>Faucet Information</h2>
    <button id="refreshInfo">Refresh</button>
    <pre id="infoBox">No data</pre>
</div>

<!-- ---------------- ADMIN SEND TOKENS TO USER ---------------- -->
<div class="panel">
    <h2>Send Faucet Tokens to User</h2>
    <label>User Wallet Address:</label><br>
    <input id="userRecipient" placeholder="0x... user address"><br>
    <button id="sendToUserBtn">Send Tokens</button>
</div>

<!-- ---------------- OWNER CONTROLS ---------------- -->
<div class="panel">
    <h2>Admin Controls</h2>

    <label>New Claim Amount (wei)</label><br>
    <input id="claimAmount" placeholder="e.g. 10000000000000000">

    <button id="updateClaim">Update Claim Amount</button>
    <br><br>

    <label>New Cooldown (seconds)</label><br>
    <input id="cooldown" placeholder="e.g. 300">

    <button id="updateCooldown">Update Cooldown</button>
    <br><br>

    <button id="pauseBtn">Pause Faucet</button>
    <button id="unpauseBtn">Unpause Faucet</button>
    <br><br>

    <label>Withdraw Amount (wei)</label><br>
    <input id="withdrawAmount" placeholder="e.g. 10000000000000000">

    <button id="withdrawBtn">Withdraw</button>
</div>

<!-- ---------------- LOGS ---------------- -->
<div id="logs"></div>

<script>
const faucetABI = [
    "constructor(uint256 _claimAmount, uint256 _cooldown)",
    "function owner() view returns(address)",
    "function claimAmount() view returns(uint256)",
    "function cooldown() view returns(uint256)",
    "function paused() view returns(bool)",
    "function lastClaim(address) view returns(uint256)",
    "function claim()",   // optional but harmless
    "function adminClaimFor(address recipient)",  // <-- NEW IMPORTANT FUNCTION
    "function setClaimAmount(uint256)",
    "function setCooldown(uint256)",
    "function setPaused(bool)",
    "function withdraw(uint256)",
    "event Claimed(address indexed user, uint256 amount)",
    "event Paused(bool status)",
    "event OwnerChanged(address indexed newOwner)",
    "event ClaimAmountUpdated(uint256 newAmount)",
    "event CooldownUpdated(uint256 newCooldown)"
];

// --------------------------------------------------
// INSERT BYTECODE HERE
// --------------------------------------------------
const faucetBYTECODE = "0x608060405260405161179e38038061179e83398181016040528101906100259190610134565b5f8211610067576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161005e906101cc565b60405180910390fd5b5f81116100a9576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016100a090610234565b60405180910390fd5b335f5f6101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff16021790555081600181905550806002819055505050610252565b5f5ffd5b5f819050919050565b61011381610101565b811461011d575f5ffd5b50565b5f8151905061012e8161010a565b92915050565b5f5f6040838503121561014a576101496100fd565b5b5f61015785828601610120565b925050602061016885828601610120565b9150509250929050565b5f82825260208201905092915050565b7f496e76616c696420616d6f756e740000000000000000000000000000000000005f82015250565b5f6101b6600e83610172565b91506101c182610182565b602082019050919050565b5f6020820190508181035f8301526101e3816101aa565b9050919050565b7f496e76616c696420636f6f6c646f776e000000000000000000000000000000005f82015250565b5f61021e601083610172565b9150610229826101ea565b602082019050919050565b5f6020820190508181035f83015261024b81610212565b9050919050565b61153f8061025f5f395ff3fe6080604052600436106100aa575f3560e01c80635c975abb116100635780635c975abb1461019f578063787a08a6146101c9578063830953ab146101f35780638da5cb5b1461021d578063b1c7ef0c14610247578063f2fde38b1461026f576100ab565b806316c38b3c146100ad57806318ea3f68146100d55780632e1a7d4d146100fd5780634e71d92d146101255780634fc3f41a1461013b5780635c16e15e14610163576100ab565b5b005b3480156100b8575f5ffd5b506100d360048036038101906100ce9190610ec2565b610297565b005b3480156100e0575f5ffd5b506100fb60048036038101906100f69190610f47565b610378565b005b348015610108575f5ffd5b50610123600480360381019061011e9190610fa5565b6106d5565b005b348015610130575f5ffd5b5061013961082f565b005b348015610146575f5ffd5b50610161600480360381019061015c9190610fa5565b610a8f565b005b34801561016e575f5ffd5b5061018960048036038101906101849190610f47565b610ba0565b6040516101969190610fdf565b60405180910390f35b3480156101aa575f5ffd5b506101b3610bb5565b6040516101c09190611007565b60405180910390f35b3480156101d4575f5ffd5b506101dd610bc7565b6040516101ea9190610fdf565b60405180910390f35b3480156101fe575f5ffd5b50610207610bcd565b6040516102149190610fdf565b60405180910390f35b348015610228575f5ffd5b50610231610bd3565b60405161023e919061102f565b60405180910390f35b348015610252575f5ffd5b5061026d60048036038101906102689190610fa5565b610bf7565b005b34801561027a575f5ffd5b5061029560048036038101906102909190610f47565b610d08565b005b5f5f9054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614610325576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161031c906110a2565b60405180910390fd5b8060035f6101000a81548160ff0219169083151502179055507f0e2fb031ee032dc02d8011dc50b816eb450cf856abd8261680dac74f72165bd28160405161036d9190611007565b60405180910390a150565b5f5f9054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614610406576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016103fd906110a2565b60405180910390fd5b60035f9054906101000a900460ff1615610455576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161044c9061110a565b60405180910390fd5b5f73ffffffffffffffffffffffffffffffffffffffff168173ffffffffffffffffffffffffffffffffffffffff16036104c3576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016104ba90611172565b60405180910390fd5b60025460045f8373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020015f20544261050f91906111bd565b1015610550576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016105479061123a565b60405180910390fd5b600154471015610595576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161058c906112a2565b60405180910390fd5b4260045f8373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020015f20819055505f8173ffffffffffffffffffffffffffffffffffffffff166001546040516105fe906112ed565b5f6040518083038185875af1925050503d805f8114610638576040519150601f19603f3d011682016040523d82523d5f602084013e61063d565b606091505b5050905080610681576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016106789061134b565b60405180910390fd5b8173ffffffffffffffffffffffffffffffffffffffff167fd8138f8a3f377c5259ca548e70e4c2de94f129f5a11036a15b69513cba2b426a6001546040516106c99190610fdf565b60405180910390a25050565b5f5f9054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614610763576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161075a906110a2565b60405180910390fd5b5f5f5f9054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16826040516107a8906112ed565b5f6040518083038185875af1925050503d805f81146107e2576040519150601f19603f3d011682016040523d82523d5f602084013e6107e7565b606091505b505090508061082b576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401610822906113b3565b60405180910390fd5b5050565b60035f9054906101000a900460ff161561087e576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016108759061110a565b60405180910390fd5b60025460045f3373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020015f2054426108ca91906111bd565b101561090b576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016109029061123a565b60405180910390fd5b600154471015610950576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401610947906112a2565b60405180910390fd5b4260045f3373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020015f20819055505f3373ffffffffffffffffffffffffffffffffffffffff166001546040516109b9906112ed565b5f6040518083038185875af1925050503d805f81146109f3576040519150601f19603f3d011682016040523d82523d5f602084013e6109f8565b606091505b5050905080610a3c576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401610a339061134b565b60405180910390fd5b3373ffffffffffffffffffffffffffffffffffffffff167fd8138f8a3f377c5259ca548e70e4c2de94f129f5a11036a15b69513cba2b426a600154604051610a849190610fdf565b60405180910390a250565b5f5f9054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614610b1d576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401610b14906110a2565b60405180910390fd5b5f8111610b5f576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401610b569061141b565b60405180910390fd5b806002819055507f583d8b24c5439ab7d810e51e37e8db41ba66f1168fd7b752ceae0c7681c5272c81604051610b959190610fdf565b60405180910390a150565b6004602052805f5260405f205f915090505481565b60035f9054906101000a900460ff1681565b60025481565b60015481565b5f5f9054906101000a900473ffffffffffffffffffffffffffffffffffffffff1681565b5f5f9054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614610c85576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401610c7c906110a2565b60405180910390fd5b5f8111610cc7576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401610cbe90611483565b60405180910390fd5b806001819055507f6a856539d0c38e2d0062c02baf02b3d784e9de37335f10d75d5ed7e606c7045681604051610cfd9190610fdf565b60405180910390a150565b5f5f9054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614610d96576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401610d8d906110a2565b60405180910390fd5b5f73ffffffffffffffffffffffffffffffffffffffff168173ffffffffffffffffffffffffffffffffffffffff1603610e04576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401610dfb906114eb565b60405180910390fd5b805f5f6101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055508073ffffffffffffffffffffffffffffffffffffffff167fa2ea9883a321a3e97b8266c2b078bfeec6d50c711ed71f874a90d500ae2eaf3660405160405180910390a250565b5f5ffd5b5f8115159050919050565b610ea181610e8d565b8114610eab575f5ffd5b50565b5f81359050610ebc81610e98565b92915050565b5f60208284031215610ed757610ed6610e89565b5b5f610ee484828501610eae565b91505092915050565b5f73ffffffffffffffffffffffffffffffffffffffff82169050919050565b5f610f1682610eed565b9050919050565b610f2681610f0c565b8114610f30575f5ffd5b50565b5f81359050610f4181610f1d565b92915050565b5f60208284031215610f5c57610f5b610e89565b5b5f610f6984828501610f33565b91505092915050565b5f819050919050565b610f8481610f72565b8114610f8e575f5ffd5b50565b5f81359050610f9f81610f7b565b92915050565b5f60208284031215610fba57610fb9610e89565b5b5f610fc784828501610f91565b91505092915050565b610fd981610f72565b82525050565b5f602082019050610ff25f830184610fd0565b92915050565b61100181610e8d565b82525050565b5f60208201905061101a5f830184610ff8565b92915050565b61102981610f0c565b82525050565b5f6020820190506110425f830184611020565b92915050565b5f82825260208201905092915050565b7f4e6f74206f776e657200000000000000000000000000000000000000000000005f82015250565b5f61108c600983611048565b915061109782611058565b602082019050919050565b5f6020820190508181035f8301526110b981611080565b9050919050565b7f46617563657420706175736564000000000000000000000000000000000000005f82015250565b5f6110f4600d83611048565b91506110ff826110c0565b602082019050919050565b5f6020820190508181035f830152611121816110e8565b9050919050565b7f496e76616c696420726563697069656e740000000000000000000000000000005f82015250565b5f61115c601183611048565b915061116782611128565b602082019050919050565b5f6020820190508181035f83015261118981611150565b9050919050565b7f4e487b71000000000000000000000000000000000000000000000000000000005f52601160045260245ffd5b5f6111c782610f72565b91506111d283610f72565b92508282039050818111156111ea576111e9611190565b5b92915050565b7f57616974206265666f7265206e65787420636c61696d000000000000000000005f82015250565b5f611224601683611048565b915061122f826111f0565b602082019050919050565b5f6020820190508181035f83015261125181611218565b9050919050565b7f46617563657420656d70747900000000000000000000000000000000000000005f82015250565b5f61128c600c83611048565b915061129782611258565b602082019050919050565b5f6020820190508181035f8301526112b981611280565b9050919050565b5f81905092915050565b50565b5f6112d85f836112c0565b91506112e3826112ca565b5f82019050919050565b5f6112f7826112cd565b9150819050919050565b7f5472616e73666572206661696c656400000000000000000000000000000000005f82015250565b5f611335600f83611048565b915061134082611301565b602082019050919050565b5f6020820190508181035f83015261136281611329565b9050919050565b7f5769746864726177206661696c656400000000000000000000000000000000005f82015250565b5f61139d600f83611048565b91506113a882611369565b602082019050919050565b5f6020820190508181035f8301526113ca81611391565b9050919050565b7f496e76616c696420636f6f6c646f776e000000000000000000000000000000005f82015250565b5f611405601083611048565b9150611410826113d1565b602082019050919050565b5f6020820190508181035f830152611432816113f9565b9050919050565b7f496e76616c696420616d6f756e740000000000000000000000000000000000005f82015250565b5f61146d600e83611048565b915061147882611439565b602082019050919050565b5f6020820190508181035f83015261149a81611461565b9050919050565b7f496e76616c6964000000000000000000000000000000000000000000000000005f82015250565b5f6114d5600783611048565b91506114e0826114a1565b602082019050919050565b5f6020820190508181035f830152611502816114c9565b905091905056fea26469706673582212205e3ead7dd9a4e0c1ef4181522972686ba66652c850a1274e1caa34f52688fe4e64736f6c634300081c0033"; 
//----------------------------------------------------

let provider, signer, walletAddress, faucet;

function log(msg) {
    const el = document.getElementById("logs");
    el.innerHTML += msg + "<br>";
    el.scrollTop = el.scrollHeight;
}

// ---------------- CONNECT WALLET ----------------
document.getElementById("connectWallet").onclick = async () => {
    if (!window.ethereum) return alert("MetaMask required");

    provider = new ethers.BrowserProvider(window.ethereum);
    signer = await provider.getSigner();
    walletAddress = await signer.getAddress();
    const net = await provider.getNetwork();

    document.getElementById("walletAddress").innerText = walletAddress;
    document.getElementById("networkName").innerText = net.name;

    log("Wallet connected: " + walletAddress);
};

// ---------------- DEPLOY CONTRACT ----------------
document.getElementById("deployContract").onclick = async () => {
    if (!signer) return alert("Connect wallet first");

    try {
        log("Creating contract factory...");

        const factory = new ethers.ContractFactory(faucetABI, faucetBYTECODE, signer);

        let args = document.getElementById("constructorArgs").value.trim();
        let parsed = args ? args.split(",").map(a => a.trim()) : [];

        log("Deploying... confirm in MetaMask");

        const contract = await factory.deploy(...parsed);
        log("Waiting for deployment...");

        await contract.waitForDeployment();
        const deployedAddr = await contract.getAddress();

        log("ðŸŽ‰ Contract deployed at: " + deployedAddr);
        alert("Contract deployed at:\n" + deployedAddr);

        faucet = new ethers.Contract(deployedAddr, faucetABI, signer);

    } catch (e) {
        log("âŒ Deploy failed: " + e.message);
    }
};

// ---------------- LOAD CONTRACT ----------------
document.getElementById("loadContract").onclick = async () => {
    const addr = document.getElementById("faucetAddressInput").value.trim();
    if (!addr) return;

    faucet = new ethers.Contract(addr, faucetABI, signer);
    log("Loaded faucet: " + addr);
};

// ---------------- REFRESH INFO ----------------
document.getElementById("refreshInfo").onclick = async () => {
    if (!faucet) return alert("Load a faucet first");

    const owner = await faucet.owner();
    const claimAmount = await faucet.claimAmount();
    const cooldown = await faucet.cooldown();
    const paused = await faucet.paused();
    const bal = await provider.getBalance(faucet.target);

    document.getElementById("infoBox").innerText =
`Owner: ${owner}
Claim Amount (wei): ${claimAmount}
Cooldown (sec): ${cooldown}
Paused: ${paused}

Faucet Balance: ${ethers.formatEther(bal)} native`;

    log("Info refreshed");
};

// ---------------- SEND TOKENS TO USER (ADMIN CLAIM) ----------------
document.getElementById("sendToUserBtn").onclick = async () => {
    if (!faucet) return alert("Load faucet first");

    const addr = document.getElementById("userRecipient").value.trim();
    if (!addr) return alert("Enter user wallet address");

    try {
        log("Sending tokens to " + addr + "...");
        const tx = await faucet.adminClaimFor(addr);
        log("TX sent: " + tx.hash);

        await tx.wait();
        log("âœ… Tokens sent successfully");

    } catch (e) {
        log("âŒ Failed: " + (e.reason || e.message));
    }
};

// ---------------- UPDATE CLAIM AMOUNT ----------------
document.getElementById("updateClaim").onclick = async () => {
    const amt = document.getElementById("claimAmount").value;
    const tx = await faucet.setClaimAmount(amt);
    await tx.wait();
    log("Claim amount updated");
};

// ---------------- UPDATE COOLDOWN ----------------
document.getElementById("updateCooldown").onclick = async () => {
    const secs = document.getElementById("cooldown").value;
    const tx = await faucet.setCooldown(secs);
    await tx.wait();
    log("Cooldown updated");
};

// ---------------- PAUSE ----------------
document.getElementById("pauseBtn").onclick = async () => {
    const tx = await faucet.setPaused(true);
    await tx.wait();
    log("Faucet paused");
};

// ---------------- UNPAUSE ----------------
document.getElementById("unpauseBtn").onclick = async () => {
    const tx = await faucet.setPaused(false);
    await tx.wait();
    log("Faucet unpaused");
};

// ---------------- WITHDRAW ----------------
document.getElementById("withdrawBtn").onclick = async () => {
    const amt = document.getElementById("withdrawAmount").value;

    try {
        const tx = await faucet.withdraw(amt);
        await tx.wait();
        log("Funds withdrawn");
    } catch (e) {
        log("Withdraw failed: " + (e.reason || e.message));
    }
};

</script>

</body>
</html>
